

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Loading and using a sampler &mdash; Extempore 0.7.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="Extempore 0.7.0 documentation" href="index.html"/>
        <link rel="next" title="Graphics" href="graphics.html"/>
        <link rel="prev" title="“Common Lisp Music”-style example" href="common-lisp-music.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Extempore
          

          
          </a>

          
            
            
              <div class="version">
                0.7
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing Extempore</a></li>
<li class="toctree-l1"><a class="reference internal" href="editor-support.html">Text editors</a></li>
<li class="toctree-l1"><a class="reference internal" href="about-this-documentation.html">About this documentation</a></li>
</ul>
<p class="caption"><span class="caption-text">Key concepts</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="philosophy.html">The Extempore philosophy</a></li>
<li class="toctree-l1"><a class="reference internal" href="caas.html">Interacting with the Extempore Compiler</a></li>
<li class="toctree-l1"><a class="reference internal" href="time.html">Time in Extempore</a></li>
<li class="toctree-l1"><a class="reference internal" href="c-xtlang-interop.html">C-xtlang interop</a></li>
<li class="toctree-l1"><a class="reference internal" href="scheme-xtlang-interop.html">Scheme-xtlang interop</a></li>
<li class="toctree-l1"><a class="reference internal" href="concurrency.html">Concurrency</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Memory management in Extempore</a></li>
</ul>
<p class="caption"><span class="caption-text">xtlang</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="types.html">xtlang types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#primitive-types">Primitive types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#aggregate-types">Aggregate types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#named-types">Named types</a></li>
<li class="toctree-l1"><a class="reference internal" href="types.html#generics">Generics</a></li>
<li class="toctree-l1"><a class="reference internal" href="type-inference.html">Type inferencing</a></li>
<li class="toctree-l1"><a class="reference internal" href="best-practices.html">Best practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials &amp; Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="audio-signal-processing.html">Audio signal processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="making-an-instrument.html">Making an instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="note-level-music.html">Playing an instrument</a></li>
<li class="toctree-l1"><a class="reference internal" href="common-lisp-music.html">&#8220;Common Lisp Music&#8221;-style example</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Loading and using a sampler</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#samplers-101">Samplers 101</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-drum-sampler">Creating a drum sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-piano-sampler">Creating a piano sampler</a></li>
<li class="toctree-l2"><a class="reference internal" href="#doing-cool-things-with-samplers">Doing cool things with samplers</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="graphics.html">Graphics</a></li>
<li class="toctree-l1"><a class="reference internal" href="impromptu-users.html">Extempore for Impromptu users</a></li>
</ul>
<p class="caption"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="getting-help.html">Getting Help</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="testing.html">Unit testing in Extempore</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">Extempore</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Loading and using a sampler</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/sampler.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="loading-and-using-a-sampler">
<h1>Loading and using a sampler<a class="headerlink" href="#loading-and-using-a-sampler" title="Permalink to this headline">¶</a></h1>
<p>A sampler is an instrument which stores chunks of audio which can be
<em>triggered</em>&#8212;played back. Samplers are used in many different ways, such
as providing digital simulations of acoustic instruments (e.g. a piano
sampler which plays recorded samples of a <em>real</em> piano when triggered by
messages from a MIDI keyboard) or they can be used to play and
manipulate non-acoustic sounds.</p>
<p>Since samplers are so useful, Extempore provides a built-in sampler in
<code class="docutils literal"><span class="pre">libs/external/instruments_ext.xtm</span></code>. This sampler basically works
like any other Extempore instrument, such as those described in
<a class="reference internal" href="making-an-instrument.html"><span class="doc">Making an instrument</span></a>), except that the note kernel closure is
already set up for you&#8212;you just have to load the sampler with sound
files. There is also a slight difference in the way we set a sampler
up: using the Scheme macro <code class="docutils literal"><span class="pre">bind-sampler</span></code> instead of
<code class="docutils literal"><span class="pre">bind-instrument</span></code>. The Extempore sampler is still an xtlang closure,
and can be used in all the same situations (e.g. as the <code class="docutils literal"><span class="pre">inst</span></code>
argument to <code class="docutils literal"><span class="pre">play-note</span></code> or <code class="docutils literal"><span class="pre">play</span></code>) as an instrument can.</p>
<div class="section" id="samplers-101">
<h2>Samplers 101<a class="headerlink" href="#samplers-101" title="Permalink to this headline">¶</a></h2>
<p>You can think of a sampler as a series of &#8216;slots&#8217;, each of which
contains a sound file.</p>
<img alt="_images/piano-full.png" src="_images/piano-full.png" />
<p>Each slot has a unique index, and playing the sampler generally involves
specifying the index of the sample to play, the loudness/velocity and
the duration. There are lots of subtleties to this process, such as what
to do when the duration is longer than the sample length, what to do if
there isn&#8217;t a sample at the given index, etc., but at a high level
that&#8217;s how it works.</p>
<p>If you look at the filenames in each slot (although it&#8217;s the audio
<em>data</em> in the slots, not the filename strings), you&#8217;ll notice that they
refer to <a class="reference external" href="http://en.wikipedia.org/wiki/WAV">wave</a> (audio) files named with <a class="reference external" href="http://en.wikipedia.org/wiki/Scientific_pitch_notation">scientific pitch notation</a>.
These wave files could be recordings of a piano, or of a violin, or even
of abstract sound effects (although at that point we&#8217;d have to wonder
why they were named with pitches from the musical scale). The sampler
doesn&#8217;t care what audio data is stored in each slot, and it&#8217;s up to you
to make sure that both the slot the audio is stored in and the audio
data itself make sense for whatever musical purpose you have in mind.</p>
<p>For sampling pitched instruments, using <a class="reference external" href="http://www.phys.unsw.edu.au/jw/notes.html">MIDI note numbers</a> (middle C =
60) make sense, and that&#8217;s the convention I&#8217;ve used in the diagram
above. If you want to trigger the sample for middle C, just use
<code class="docutils literal"><span class="pre">play-note</span></code> with a pitch argument of <code class="docutils literal"><span class="pre">60</span></code>.</p>
<p>The Extempore sampler doesn&#8217;t <em>have</em> to be full&#8212;there can be empty
slots.</p>
<img alt="_images/piano-gaps.png" src="_images/piano-gaps.png" />
<p>In this situation, when the sampler gets a <code class="docutils literal"><span class="pre">play-note</span></code> message
corresponding to an empty slot, looks for the closest &#8216;filled&#8217; slot,
grabs that audio data, and linearly pitch-shifts it to play at the
required pitch.</p>
<p>For example, say a message came in to play sample <code class="docutils literal"><span class="pre">72</span></code> (one octave
above middle C). If the closest filled slot was middle C (slot <code class="docutils literal"><span class="pre">60</span></code>),
then the sampler would play the middle C audio file pitch-shifted up one
octave. If you&#8217;ve ever looked into the maths behind musical notes,
you&#8217;ll know that for every octave increase in pitch, the frequency of
the waveform doubles. So, to play a sample <em>up an octave</em>, we play it
back at double speed. In practice, because the audio sample rate is
constant, we only play every second sample, which has the same
effect&#8212;we&#8217;re progressing through the audio data twice as fast. This is
the same reason that when you hit fast-forward on a tape player (do
people still remember tape players) while it&#8217;s playing then you get a
hilarious chipmunk effect, because everyone&#8217;s voices are pitch-shifted
up.</p>
<p>If we&#8217;re not pitch-shifting by a whole octave, then the maths is a bit
trickier (it&#8217;s not just a matter of doubling the frequency), but the
Extempore sampler takes care of that for us (including all sorts of
fancy stuff like interpolating between individual audio samples). When
<code class="docutils literal"><span class="pre">play-note</span></code> calls an empty slot in the sampler, the pitch-shifting
up or down is taken care of, and it works as though we <em>did</em> have an
audio file in that slot. The exception to this rule is if the audio
sample has a meaningful tempo&#8212;such as a full drum loop. In this case,
because the pitch-shifting is also speeding up or slowing down the
sample playback, the tempo will be altered as well. Which may be fine,
but it may also be a problem. If you&#8217;re in that situation, then you&#8217;ll
probably want to make sure you have audio data in all the slots you&#8217;re
going to trigger.</p>
<p>There is the potential for a loss in audio quality the further (in pitch
terms) an audio file has to be shifted. Still, the &#8216;missing sample
interpolation&#8217; allows us to make a trade-off between sound quality and
memory footprint. If sound quality is more important, use more slots,
but if low memory use is more important, use fewer slots and let the
sampler interpolate in the gaps.</p>
</div>
<div class="section" id="creating-a-drum-sampler">
<h2>Creating a drum sampler<a class="headerlink" href="#creating-a-drum-sampler" title="Permalink to this headline">¶</a></h2>
<p>Ok, enough background material&#8212;let&#8217;s make some noise. We&#8217;ll create an
instance of Extempore&#8217;s sampler called <code class="docutils literal"><span class="pre">drums</span></code>. To do this, we use the
<code class="docutils literal"><span class="pre">bind-sampler</span></code> Scheme macro (once we&#8217;ve loaded it from the
<code class="docutils literal"><span class="pre">libs/external/instruments_ext.xtm</span></code> library file).</p>
<div class="code extempore highlight-default"><div class="highlight"><pre>(sys:load &quot;libs/external/instruments_ext.xtm&quot;)

;; define a sampler (called drums) using the default sampler note kernel and effects
(bind-sampler drums sampler_note_hermite_c sampler_fx)

;; add the sampler to the dsp output callback
(bind-func dsp:DSP
  (lambda (in time chan dat)
    (cond ((&lt; chan 2)
           (drums in time chan dat))
          (else 0.0))))

(dsp:set! dsp)
</pre></div>
</div>
<p>But we&#8217;re not done yet: the xtlang closure <code class="docutils literal"><span class="pre">drums</span></code> has been compiled,
but it hasn&#8217;t had any samples loaded into it&#8217;s slots yet. So we need
some drum samples, then. Extempore doesn&#8217;t ship with any samples, you&#8217;ll
have to provide your own. The <a class="reference external" href="https://archive.org/download/SalamanderDrumkit/salamanderDrumkit.tar.bz2">Salamander drumkit</a> is pretty cool–and
also free, which is nice :) So I&#8217;m going to load those samples into my
<code class="docutils literal"><span class="pre">drums</span></code> sampler.</p>
<p>First, download the Salamander drum kit samples, unzip and untar them
and put the files somewhere. On my computer, I&#8217;ve put them into
<code class="docutils literal"><span class="pre">/Users/ben/Music/sample-libs/drums/salamander</span></code>, but you can put them
wherever you like. Just make sure that you set the right path in your
code if you&#8217;re following along.</p>
<p>When you unzip and untar <code class="docutils literal"><span class="pre">salamanderDrumkit.tar.bz2</span></code>, it will have a
subdirectory called <code class="docutils literal"><span class="pre">OH</span></code>, which contains the wave files which contain
the drum sounds. We&#8217;re going to load (some of) these files into our
<code class="docutils literal"><span class="pre">drums</span></code> sampler one at a time using the <code class="docutils literal"><span class="pre">set-sampler-index</span></code>
function.</p>
<div class="code extempore highlight-default"><div class="highlight"><pre><span class="p">(</span><span class="n">define</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;/Users/ben/Music/sample-libs/drums/salamander/OH/&quot;</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;kick_OH_F_9.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">kick</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;snareStick_OH_F_9.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">side</span><span class="o">-</span><span class="n">stick</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;snare_OH_FF_9.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">snare</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;hihatClosed_OH_F_20.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">closed</span><span class="o">-</span><span class="n">hi</span><span class="o">-</span><span class="n">hat</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;hihatFoot_OH_MP_12.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">pedal</span><span class="o">-</span><span class="n">hi</span><span class="o">-</span><span class="n">hat</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;hihatOpen_OH_FF_6.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="nb">open</span><span class="o">-</span><span class="n">hi</span><span class="o">-</span><span class="n">hat</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;loTom_OH_FF_8.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">low</span><span class="o">-</span><span class="n">floor</span><span class="o">-</span><span class="n">tom</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;hiTom_OH_FF_9.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">hi</span><span class="o">-</span><span class="n">floor</span><span class="o">-</span><span class="n">tom</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;crash1_OH_FF_6.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">crash</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;ride1_OH_FF_4.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">ride</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;china1_OH_FF_8.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">chinese</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;cowbell_FF_9.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">cowbell</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;bellchime_F_3.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="nb">open</span><span class="o">-</span><span class="n">triangle</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">(</span><span class="nb">set</span><span class="o">-</span><span class="n">sampler</span><span class="o">-</span><span class="n">index</span> <span class="n">drums</span> <span class="p">(</span><span class="n">string</span><span class="o">-</span><span class="n">append</span> <span class="n">drum</span><span class="o">-</span><span class="n">path</span> <span class="s2">&quot;ride1Bell_OH_F_6.wav&quot;</span><span class="p">)</span> <span class="o">*</span><span class="n">gm</span><span class="o">-</span><span class="n">ride</span><span class="o">-</span><span class="n">bell</span><span class="o">*</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>If that works properly, some info will be printed to the log about the
audio files which have been loaded into the sampler. They should look
something like this:</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">file</span> <span class="n">name</span><span class="p">:</span>     <span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Music</span><span class="o">/</span><span class="n">sample</span><span class="o">-</span><span class="n">libs</span><span class="o">/</span><span class="n">drums</span><span class="o">/</span><span class="n">salamander</span><span class="o">/</span><span class="n">OH</span><span class="o">/</span><span class="n">kick_OH_F_9</span><span class="o">.</span><span class="n">wav</span>
<span class="n">samplerate</span><span class="p">:</span>    <span class="mi">48000</span>
<span class="n">channels</span><span class="p">:</span>      <span class="mi">2</span>
<span class="n">samples</span> <span class="n">read</span><span class="p">:</span>  <span class="mi">45796</span>
<span class="mi">45796</span> <span class="n">samples</span>
<span class="n">read</span><span class="o">/</span><span class="n">Users</span><span class="o">/</span><span class="n">ben</span><span class="o">/</span><span class="n">Music</span><span class="o">/</span><span class="n">sample</span><span class="o">-</span><span class="n">libs</span><span class="o">/</span><span class="n">drums</span><span class="o">/</span><span class="n">salamander</span><span class="o">/</span><span class="n">OH</span><span class="o">/</span><span class="n">kick_OH_F_9</span><span class="o">.</span><span class="n">wav</span><span class="p">:</span>
<span class="mi">2</span><span class="p">(</span><span class="n">channels</span><span class="p">)</span> <span class="mi">22898</span><span class="p">(</span><span class="n">frames</span><span class="p">):</span><span class="mf">357.781250</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>     <span class="n">into</span> <span class="n">index</span><span class="p">:</span><span class="mi">35</span>
</pre></div>
</div>
<p>If the log doesn&#8217;t show something like that, then there are a few things
which could have gone wrong:</p>
<ul class="simple">
<li>have you set up <code class="docutils literal"><span class="pre">libsndfile</span></code> properly on your system?</li>
<li>are the pathnames to to samples correct?</li>
<li>did you define the <code class="docutils literal"><span class="pre">drums</span></code> sampler and did it compile properly?</li>
</ul>
<p>Assuming things worked properly, we should be able to play our <code class="docutils literal"><span class="pre">drums</span></code>
sampler.</p>
<div class="code extempore highlight-default"><div class="highlight"><pre>;; evaluate these as you see fit!
(play-note (now) drums *gm-kick* 80 44100)
(play-note (now) drums *gm-snare* 80 44100)
(play-note (now) drums *gm-closed-hi-hat* 80 44100)
</pre></div>
</div>
<p>Cool, seems to work fine. For a tutorial on how to generate beats and
drum patterns, check out <a class="reference internal" href="note-level-music.html"><span class="doc">Playing an instrument</span></a>.</p>
</div>
<div class="section" id="creating-a-piano-sampler">
<h2>Creating a piano sampler<a class="headerlink" href="#creating-a-piano-sampler" title="Permalink to this headline">¶</a></h2>
<p>Ok, drums are loaded, let&#8217;s add one more sampler&#8212;this time a <code class="docutils literal"><span class="pre">piano</span></code>.</p>
<div class="code extempore highlight-default"><div class="highlight"><pre><span class="p">(</span><span class="n">bind</span><span class="o">-</span><span class="n">sampler</span> <span class="n">piano</span> <span class="n">sampler_note_hermite_c</span> <span class="n">sampler_fx</span><span class="p">)</span>

<span class="p">;;</span> <span class="n">add</span> <span class="n">the</span> <span class="n">piano</span> <span class="n">sampler</span> <span class="n">to</span> <span class="n">the</span> <span class="n">dsp</span> <span class="n">output</span> <span class="n">callback</span>
<span class="p">;;</span> <span class="n">note</span> <span class="n">how</span> <span class="n">the</span> <span class="n">drums</span> <span class="ow">is</span> <span class="n">still</span> <span class="n">there</span> <span class="kn">from</span> <span class="nn">before</span>
<span class="p">(</span><span class="n">bind</span><span class="o">-</span><span class="n">func</span> <span class="n">dsp</span><span class="p">:</span><span class="n">DSP</span>
  <span class="p">(</span><span class="k">lambda</span> <span class="p">(</span><span class="ow">in</span> <span class="n">time</span> <span class="n">chan</span> <span class="n">dat</span><span class="p">)</span>
    <span class="p">(</span><span class="n">cond</span> <span class="p">((</span><span class="o">&lt;</span> <span class="n">chan</span> <span class="mf">2.0</span><span class="p">)</span>
           <span class="p">(</span><span class="o">+</span> <span class="p">(</span><span class="n">drums</span> <span class="ow">in</span> <span class="n">time</span> <span class="n">chan</span> <span class="n">dat</span><span class="p">)</span>
              <span class="p">(</span><span class="n">piano</span> <span class="ow">in</span> <span class="n">time</span> <span class="n">chan</span> <span class="n">dat</span><span class="p">)))</span>
          <span class="p">(</span><span class="k">else</span> <span class="mf">0.0</span><span class="p">))))</span>
</pre></div>
</div>
<p>Luckily, there&#8217;s a <a class="reference external" href="http://download.linuxaudio.org/lau/SalamanderGrandPianoV2/SalamanderGrandPianoV2_44.1khz16bit.tar.bz2">Salamander piano</a> as well, which will do just fine
for today. Go ahead and download that (you&#8217;ll want the version called
<code class="docutils literal"><span class="pre">SalamanderGrandPianoV2_44.1khz16bit.tar.bz2</span></code>). Again, unzip and untar
the files to wherever you put that sort of thing. This time, the wave
audio files should be in a <code class="docutils literal"><span class="pre">44.1khz16bit</span></code> subdirectory. Looking at the
files in that directory (e.g. with <code class="docutils literal"><span class="pre">ls</span></code>), we get something like</p>
<div class="code bash highlight-default"><div class="highlight"><pre><span class="n">A0v1</span><span class="o">.</span><span class="n">wav</span>   <span class="n">A5v6</span><span class="o">.</span><span class="n">wav</span>   <span class="n">C4v2</span><span class="o">.</span><span class="n">wav</span>    <span class="n">D</span><span class="c1">#2v13.wav  F#1v1.wav   F#6v6.wav</span>
<span class="n">A0v10</span><span class="o">.</span><span class="n">wav</span>  <span class="n">A5v7</span><span class="o">.</span><span class="n">wav</span>   <span class="n">C4v3</span><span class="o">.</span><span class="n">wav</span>    <span class="n">D</span><span class="c1">#2v14.wav  F#1v10.wav  F#6v7.wav</span>
<span class="n">A0v11</span><span class="o">.</span><span class="n">wav</span>  <span class="n">A5v8</span><span class="o">.</span><span class="n">wav</span>   <span class="n">C4v4</span><span class="o">.</span><span class="n">wav</span>    <span class="n">D</span><span class="c1">#2v15.wav  F#1v11.wav  F#6v8.wav</span>
<span class="n">A0v12</span><span class="o">.</span><span class="n">wav</span>  <span class="n">A5v9</span><span class="o">.</span><span class="n">wav</span>   <span class="n">C4v5</span><span class="o">.</span><span class="n">wav</span>    <span class="n">D</span><span class="c1">#2v16.wav  F#1v12.wav  F#6v9.wav</span>
<span class="n">A0v13</span><span class="o">.</span><span class="n">wav</span>  <span class="n">A6v1</span><span class="o">.</span><span class="n">wav</span>   <span class="n">C4v6</span><span class="o">.</span><span class="n">wav</span>    <span class="n">D</span><span class="c1">#2v2.wav   F#1v13.wav  F#7v1.wav</span>
<span class="n">A0v14</span><span class="o">.</span><span class="n">wav</span>  <span class="n">A6v10</span><span class="o">.</span><span class="n">wav</span>  <span class="n">C4v7</span><span class="o">.</span><span class="n">wav</span>    <span class="n">D</span><span class="c1">#2v3.wav   F#1v14.wav  F#7v10.wav</span>

<span class="o">...</span> <span class="n">plus</span> <span class="n">many</span> <span class="n">more</span> <span class="n">files</span>
</pre></div>
</div>
<p>So it looks like the files are named with a simple naming convention,
which makes use of scientific pitch notation. For example, <code class="docutils literal"><span class="pre">C4v5.wav</span></code>
looks like it&#8217;s a recording of C4 (middle C) on the piano, and the
<code class="docutils literal"><span class="pre">v5</span></code> part probably means that it&#8217;s the 5th velocity layer for the note
C4. This means that there are multiple sound files (called <em>layers</em>) for
each note, and the sampler will choose which one to play based on the
velocity argument in the triggering call. Not all sample libraries will
have multiple velocity layers, but they&#8217;re a way of capturing the
differences in sound between soft notes and loud notes&#8212;particularly on
instruments where the difference between soft and loud is in more than
just volume (such as a <a class="reference external" href="http://en.wikipedia.org/wiki/Rhodes_piano">Fender Rhodes</a>).</p>
<p>Extempore&#8217;s built-in sampler <strong>does not</strong> support layers, although if
you wanted to add that functionality in you could easily hack the
sampler source code in <code class="docutils literal"><span class="pre">external/instruments.xtm</span></code>. So, what we want to
do is choose just one of the layer files for each note to load into the
sampler. We could choose the loudest layer, or the softest layer, or a
random layer for each note (although this would lead to uneven loudness
when playing the sampler with <code class="docutils literal"><span class="pre">play-note</span></code>). The main point is that we
can only load <em>one</em> of the layers by default.</p>
<p>So if the audio files are named according to a meaninful convention, is
there a way to make use of that? Loading each audio file individually
can be pretty time-consuming&#8212;not to mention error-prone! How do we take
a list of files (such as the output of <code class="docutils literal"><span class="pre">ls</span></code> above) and tell our
sampler which files to load into which slots?</p>
<p>To do this, <code class="docutils literal"><span class="pre">external/instruments.xtm</span></code> provides a helper macro called
<code class="docutils literal"><span class="pre">load-sampler</span></code>. Looking at the definition for <code class="docutils literal"><span class="pre">load-sampler</span></code>, we see
that it takes the three arguments:</p>
<ol class="arabic simple">
<li><code class="docutils literal"><span class="pre">sampler</span></code>, the sampler closure</li>
<li><code class="docutils literal"><span class="pre">path</span></code>, the path to the directory where the audio files are</li>
<li><code class="docutils literal"><span class="pre">parser</span></code>, a (Scheme) function</li>
</ol>
<p>The first two arguments are fairly self-explanatory, but the third one
(the parser function) is where the magic happens.</p>
<p><code class="docutils literal"><span class="pre">load-sampler</span></code> first creates a list of all the files (including hidden
files) in the <code class="docutils literal"><span class="pre">path</span></code> directory. This list of filenames is then passed
(as the single argument) to the function which was passed in as the
<code class="docutils literal"><span class="pre">parser</span></code> argument to <code class="docutils literal"><span class="pre">load-sampler</span></code>. This parser function&#8217;s job is
to take that messy list of filenames and return a nice neat &#8216;list of
lists&#8217;, telling the sampler which files to load into which slots. Each
of the elements of this list returned by the parser function has to have
four elements:</p>
<ol class="arabic simple">
<li>the filename</li>
<li>the slot (midi note number) to load the file into</li>
<li>the sample offset (i.e. if the sample should start playing part-way
into the audio file)</li>
<li>the sample length (or <code class="docutils literal"><span class="pre">0</span></code> to load the whole file, which is what
you&#8217;ll want to do in most cases).</li>
</ol>
<p>So, going back to our filename example earlier, we want a filename like
<code class="docutils literal"><span class="pre">C4v5.wav</span></code> to get mapped into a list like <code class="docutils literal"><span class="pre">(&quot;C4v5.wav&quot;</span> <span class="pre">60</span> <span class="pre">0</span> <span class="pre">0)</span></code>. The
<code class="docutils literal"><span class="pre">60</span></code> is for middle C (C4), and the two <code class="docutils literal"><span class="pre">0</span></code> arguments mean a sample
offset of <code class="docutils literal"><span class="pre">0</span></code> (so the file starts playing from the start) and plays
for its whole length. Writing a Scheme function which can do this
parsing isn&#8217;t too difficult, and would look something like this</p>
<div class="code extempore highlight-default"><div class="highlight"><pre>(define parse-salamander-piano
  (lambda (file-list)
    (map (lambda (fname)
           (let ((result (regex:matched fname &quot;^.*([ABCDEFG][#b]?[0-9])v([0-9]+)\.(wav|aif|aiff|ogg)$&quot;)))
             (if (null? result)
                 (begin (println &#39;Cannot &#39;parse &#39;filename: fname)
                        #f)
                 ;; load 4th velocity layer only
                 (if (= (string-&gt;number (caddr result)) 4)
                     (list fname
                           (note-name-to-midi-number (cadr result))
                           0
                           0)
                     #f))))
         file-list)))

(load-sampler piano
              &quot;/Users/ben/Music/sample-libs/piano/salamander/44.1khz16bit&quot;
              0 ;; &#39;sound bank&#39; index
              parse-salamander-piano)
</pre></div>
</div>
<p>When you call <code class="docutils literal"><span class="pre">load-sampler</span></code> at the bottom of that code chunk, it
should load all the 4th velocity layers into bank <code class="docutils literal"><span class="pre">0</span></code> of the <code class="docutils literal"><span class="pre">piano</span></code>
sampler. The bank argument is necessary because each sampler can have
multiple sound banks. The default bank is bank <code class="docutils literal"><span class="pre">0</span></code>, so if you don&#8217;t
want to use multiple sound banks just load into bank <code class="docutils literal"><span class="pre">0</span></code> and forget
about it.</p>
<p>And finally, to try it out:</p>
<div class="code extempore highlight-default"><div class="highlight"><pre><span class="p">(</span><span class="n">play</span><span class="o">-</span><span class="n">note</span> <span class="p">(</span><span class="n">now</span><span class="p">)</span> <span class="n">piano</span> <span class="p">(</span><span class="n">random</span> <span class="mi">40</span> <span class="mi">80</span><span class="p">)</span> <span class="mi">80</span> <span class="mi">44100</span><span class="p">)</span>
</pre></div>
</div>
<p>Awesome, we&#8217;ve got a piano. Success!</p>
</div>
<div class="section" id="doing-cool-things-with-samplers">
<h2>Doing cool things with samplers<a class="headerlink" href="#doing-cool-things-with-samplers" title="Permalink to this headline">¶</a></h2>
<p>There are lots of possibilities at this stage. If you&#8217;re interested in
seeing how to make vaguely &#8216;conventional&#8217; musical material, then
<a class="reference internal" href="note-level-music.html"><span class="doc">Playing an instrument</span></a> is a good place to start. And I&#8217;m sure you can
think of lots of other possibilities—go nuts :)</p>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="graphics.html" class="btn btn-neutral float-right" title="Graphics" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="common-lisp-music.html" class="btn btn-neutral" title="“Common Lisp Music”-style example" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Andrew Sorensen.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.7.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>